(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{3120:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=this,s=t.$createElement,a=t._self._c||s;return a("q-page",{attrs:{padding:""}},[a("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:t.createUserDialog,callback:function(e){t.createUserDialog=e},expression:"createUserDialog"}},[a("q-card",{staticClass:"bg-secondary text-white"},[a("q-card-section",{staticClass:"text-center text-h3"},[a("div",{staticClass:"text-subtitle2"},[t._v("Create New User")])]),a("q-separator",{attrs:{dark:""}}),a("q-card-section",[a("q-form",{ref:"userRegistrationForm",staticClass:"col q-gutter-md text-white",on:{submit:t.createUser,reset:t.onReset}},[a("q-input",{attrs:{filled:"",type:"text",label:"first name",hint:"first name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your name"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.firstName,callback:function(e){t.firstName=e},expression:"firstName"}}),a("q-input",{attrs:{filled:"",type:"text",label:"last name",hint:"last name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your name"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.lastName,callback:function(e){t.lastName=e},expression:"lastName"}}),a("q-input",{attrs:{filled:"",type:"email",label:"email",hint:"email","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your email address"},function(t){return e.isValidEmail()||"Invalid email address"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),a("q-input",{attrs:{filled:"",type:"password",label:"Password","lazy-rules":"",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":t.passwordErrorMessage},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),a("q-input",{attrs:{filled:"",type:"password",label:"Password","lazy-rules":"",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":t.passwordErrorMessage},model:{value:t.cpassword,callback:function(e){t.cpassword=e},expression:"cpassword"}}),a("div",{staticClass:"col"},[a("q-btn",{attrs:{label:"Create",type:"submit",color:"primary"}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}})],1)],1)],1)],1)],1),a("div",{staticClass:"row"},[a("q-table",{staticClass:"col",attrs:{title:"Users",dense:"",data:t.users,columns:t.columns,filter:t.filter,"row-key":"index"},on:{"row-click":t.selectUser},scopedSlots:t._u([{key:"top-right",fn:function(){return[a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[a("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1),a("q-btn",{attrs:{flat:""}},[a("q-icon",{attrs:{color:"primary",name:"refresh",side:""},on:{click:function(e){return t.fetchUsers()}}})],1),a("q-btn",{attrs:{flat:""}},[a("q-icon",{attrs:{color:"primary",name:"add_circle",side:""},on:{click:function(e){t.createUserDialog=!0}}})],1)]},proxy:!0}])})],1),a("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:t.selectedUser,callback:function(e){t.selectedUser=e},expression:"selectedUser"}},[a("q-card",[a("q-card-section",[a("div",{staticClass:"text-h6 text-center"},[t._v(t._s(t.selectedFirstName)+" "+t._s(t.selectedLastName))])]),a("q-card-section",{staticClass:"q-pt-none text-center"},[t._v("\n       "+t._s(t.selectedEmail)+"\n      ")]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-btn",{attrs:{label:"delete"},on:{click:t.deleteUser}},[a("q-icon",{attrs:{name:"delete",color:"red"}})],1),a("q-btn",{attrs:{label:"roles"},on:{click:t.userRoles}},[a("q-icon",{attrs:{name:"security",color:"primary"}})],1),a("q-btn",{attrs:{label:"projects"},on:{click:t.userProjects}},[a("q-icon",{attrs:{name:"group_work",color:"secondary"}})],1),a("q-btn",{attrs:{label:"Edit"},on:{click:t.editUser}},[a("q-icon",{attrs:{name:"group_work",color:"secondary"}})],1)],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Ok",color:"primary"}})],1)],1)],1)],1)},r=[],i=(s("e6cf"),s("ddb0"),s("cf57"));s("bc3a");const l=s("1712").to,n=s("ff00"),o=s("547a").default;var c={name:"Users",components:{},async created(){o.setSettings({TBURL:n["TB_URL"]}),o.setSettings(n);let[e,t]=await l(o.isLoggedIn());e?window.location.assign("#/"):[e,t]=await l(this.fetchUsers())},data(){return{email:"",firstName:"",lastName:"",password:"",cpassword:"",passwordErrorMessage:"",users:[],filter:"",selectedUser:!1,createUserDialog:!1,columns:[{name:"firstName",required:!0,label:"First Name",align:"left",field:e=>e.firstName,format:e=>`${e||""}`,sortable:!0},{name:"lastName",required:!0,label:"Last Name",align:"left",field:e=>e.lastName,format:e=>`${e||""}`,sortable:!0},{name:"email",required:!0,label:"Email",align:"left",field:e=>e.email,format:e=>`${e||""}`,sortable:!0}],selectedEmail:"",selectedId:"",selectedFirstName:"",selectedLastName:""}},methods:{submit(){this.$refs.userRegistrationForm.submit()},selectUser(e,t){this.selectedUser=!0,this.selectedEmail=t.email,this.selectedId="object"===typeof t.id?t.id.id:t.id,this.selectedFirstName=t.firstName,this.selectedLastName=t.lastName,console.log("clicked on",t)},isValidEmail(){const e=/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/;return e.test(this.email)||"Invalid email"},onReset(){this.email=null,this.firstName=null,this.lastName=null,this.password=null,this.cpassword=null},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:i["a"],color:"primary"},persistent:!0,ok:!1}),s=setInterval((()=>{!1===this.working&&(clearInterval(s),t.hide())}),500)},alert(e){alert(e)},async createUser(){return new Promise((async(e,t)=>{if(this.password!==this.cpassword)return this.cpassword="",this.passwordErrorMessage="Passwords don't match",this.$q.notify({type:"negative",message:"Passwords don't match"}),e(!1);this.working=!0,this.showCustom();let[s,a]=await l(o.createUser({user:this.email,firstName:this.firstName,lastName:this.lastName,password:this.password}));this.working=!1,s?(this.$q.notify({type:"negative",message:s.msg||s}),e(!1)):this.users.push(a)}))},async fetchUsers(){return new Promise((async(e,t)=>{this.working=!0,this.showCustom();let[s,a]=await l(o.fetchUsers());this.working=!1,s?(this.$q.notify({type:"negative",message:s}),e(!1)):(this.users=a.users,e(a.users))}))},async deleteUser(e){return new Promise((async(e,t)=>{let[s,a]=await l(this.confirm(`Are you sure you want to delete ${this.selectedEmail}`,"Delete User"));return s?e(!1):(this.working=!0,this.showCustom(),[s,a]=await l(o.deleteUser(this.selectedId)),this.working=!1,s?(console.log(s),this.$q.notify({type:"negative",message:s.msg||s}),e(!1)):(this.users=a.users,this.selectedUser=!1,this.$q.notify({type:"positive",message:`${this.selectedEmail} deleted.`}),void e(a.users)))}))},async confirm(e,t="Confirm"){return new Promise(((s,a)=>{this.$q.dialog({title:t,message:e,cancel:!0,persistent:!0}).onOk((()=>s(!0))).onOk((()=>s(!0))).onCancel((()=>a(!0))).onDismiss((()=>a(!0)))}))},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:i["a"],color:"primary"},persistent:!0,ok:!1}),s=setInterval((()=>{!1===this.working&&(clearInterval(s),t.hide())}),500)}}},d=c,m=s("2877"),u=s("9989"),p=s("24e8"),f=s("f09f"),h=s("a370"),w=s("eb85"),y=s("0378"),g=s("27f9"),b=s("9c40"),q=s("eaac"),k=s("0016"),v=s("bd08"),N=s("db86"),U=s("42a1"),C=s("1c1c"),x=s("0170"),Q=s("2c91"),E=s("66e5"),_=s("4074"),P=s("4b7e"),$=s("7f67"),I=s("eebe"),z=s.n(I),L=Object(m["a"])(d,a,r,!1,null,null,null);t["default"]=L.exports;z()(L,"components",{QPage:u["a"],QDialog:p["a"],QCard:f["a"],QCardSection:h["a"],QSeparator:w["a"],QForm:y["a"],QInput:g["a"],QBtn:b["a"],QTable:q["a"],QIcon:k["a"],QTr:v["a"],QTd:N["a"],QPopupEdit:U["a"],QList:C["a"],QItemLabel:x["a"],QSpace:Q["a"],QItem:E["a"],QItemSection:_["a"],QCardActions:P["a"]}),z()(L,"directives",{ClosePopup:$["a"]})}}]);