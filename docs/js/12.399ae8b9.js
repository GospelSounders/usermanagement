(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"996f":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"flex flex-center",attrs:{padding:""}},[e.loaded?s("q-card",{staticClass:"items-center text-center bg-white"},[s("q-card-section",[s("div",{staticClass:"row"},[s("div",{staticClass:"items-left text-left"},[s("div",{staticClass:"text-h4"},[e._v("Profile")]),s("div",[e._v(e._s(e.email))])]),s("q-space"),s("div",{staticClass:"items-left text-left text-weight-thin"},[s("div",[e._v("Last Login")]),s("div",[e._v(e._s(e.lastLogin))])])],1)]),s("q-card-section",[s("q-form",{ref:"changeUserNameForm",staticClass:"q-gutter-md text-white",on:{submit:e.changeuserNames,reset:e.onReset}},[s("q-input",{attrs:{filled:"",type:"text",label:"First Name",hint:"First Name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your first name"}]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitChangeUserName(t)}},model:{value:e.firstName,callback:function(t){e.firstName=t},expression:"firstName"}}),s("q-input",{attrs:{filled:"",type:"text",label:"Last Name",hint:"Last Name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your last name"}]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitChangeUserName(t)}},model:{value:e.lastName,callback:function(t){e.lastName=t},expression:"lastName"}}),s("div",{staticClass:"row"},[s("div",{staticClass:"items-left text-left"},[s("q-btn",{attrs:{label:"Change Password",color:"primary"},on:{click:function(t){e.changePasswordDialog=!0}}})],1)]),s("div",{staticClass:"row"},[s("div",{staticClass:"items-left text-left"},[s("q-btn",{attrs:{label:"Delete Account",color:"red"},on:{click:e.deleteAccount}})],1),s("q-space"),s("div",{staticClass:"items-left text-left"},[s("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}}),s("q-btn",{attrs:{label:"Save",type:"submit",color:"green",disable:e.userEditted}})],1)],1)],1)],1)],1):e._e(),s("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:e.changePasswordDialog,callback:function(t){e.changePasswordDialog=t},expression:"changePasswordDialog"}},[s("q-card",[s("q-card-section",{staticClass:"bg-secondary text-white text-h5 text-center"},[e._v("\n        Change Password\n      ")]),s("q-card-section",[s("q-form",{ref:"changePasswordForm",staticClass:"q-gutter-md text-white",on:{submit:e.changePassword,reset:e.onResetChangePassword}},[s("q-input",{attrs:{filled:"",type:"password",label:"Current Password",hint:"Current Password","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your current pasword"}]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitChangePassword(t)}},model:{value:e.currentPassword,callback:function(t){e.currentPassword=t},expression:"currentPassword"}}),s("q-input",{attrs:{filled:"",type:"password",label:"New Password",hint:"New Password","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your new pasword"}]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitChangePassword(t)}},model:{value:e.newPassword,callback:function(t){e.newPassword=t},expression:"newPassword"}}),s("q-input",{attrs:{filled:"",type:"password",label:"Confirm New Password",hint:"Confirm New Password","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please confirm your new pasword"}],"error-message":e.confirmPasswordError},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitChangePassword(t)}},model:{value:e.newPasswordAgain,callback:function(t){e.newPasswordAgain=t},expression:"newPasswordAgain"}}),s("div",{staticClass:"row"},[s("q-space"),s("div",{staticClass:"items-left text-left"},[s("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}}),s("q-btn",{attrs:{label:"Change Password",type:"submit",color:"green"}})],1)],1)],1)],1)],1)],1)],1)},r=[];s("e6cf"),s("5319"),s("ddb0"),s("cf57");s("bc3a");const i=s("1712").to,n=s("ff00"),o=s("547a").default,l=s("6daa").default;var d={name:"Profile",components:{},async created(){let e=l.showDialog(this,"Checking Auth","");o.setSettings({TBURL:n["TB_URL"]}),o.setSettings(n);let[t,s]=await i(o.isLoggedIn());l.emit(e),t?window.location.assign("#/"):(this.profilePath=n["TB_URL"].replace("/api","")+"/profile",e=l.showDialog(this,"Checking Auth",""),[t,s]=await i(o.readUserData()),l.emit(e),t?window.location.assign("#/"):this.setUserData(s))},data(){return{profilePath:"",userData:{},email:"",firstName:"",lastName:"",firstNameOriginal:"",lastNameOriginal:"",currentPassword:"",newPassword:"",newPasswordAgain:"",loaded:!1,changePasswordDialog:!1,lastLogin:"",confirmPasswordError:""}},methods:{onReset(){this.firstName=this.firstNameOriginal,this.lastName=this.lastNameOriginal},onResetChangePassword(){this.currentPassword="",this.newPassword="",this.newPasswordAgain=""},setUserData(e){this.userData=e,this.email=e.email,this.firstName=e.firstName,this.lastName=e.lastName,this.firstNameOriginal=e.firstName,this.lastNameOriginal=e.lastName,this.loaded=!0,this.lastLogin=new Date(e.additionalInfo.lastLoginTs)},async changeuserNames(){return new Promise((async(e,t)=>{if(this.notUserEditted())return e(!1);let s=this.userData;s.firstName=this.firstName,s.lastName=this.lastName;let a=l.showDialog(this,"Checking Auth",""),[r,n]=await i(o.saveUserData(s));if(l.emit(a),r)return this.$q.notify({type:"negative",message:r.msg||r}),e(!1);this.setUserData(n),e(n)}))},async changePassword(){return new Promise((async(e,t)=>{if(this.newPassword!==this.newPasswordAgain)return this.newPasswordAgain="",this.confirmPasswordError="Passwords don't match",e(!1);let s={currentPassword:this.currentPassword,newPassword:this.newPassword},a=l.showDialog(this,"Changing Password",""),[r,n]=await i(o.changePassword(s));if(l.emit(a),r)return this.$q.notify({type:"negative",message:r.msg||r.response.data.message||r.message||r}),e(!1);this.$q.notify({type:"positive",message:"Password changed."}),this.changePasswordDialog=!1,e(n)}))},async deleteAccount(){return new Promise((async(e,t)=>{let[s,a]=await i(l.confirm(this,"Are you sure you want to delete your account","Delete Account"));if(s)return e(!1);console.log(this.userData),console.log("prceed to delete");let r=l.showDialog(this,"Checking Auth","");if([s,a]=await i(o.deleteUser(this.userData.id.id,!0)),l.emit(r),s)return this.$q.notify({type:"negative",message:s.msg||s}),e(!1);this.$q.notify({type:"positive",message:"Your account has been deleted"})}))},submitChangeUserName(){this.$refs.changeUserNameForm.submit()},submitChangePassword(){this.$refs.changePasswordForm.submit()},notUserEditted(){return this.firstName===this.firstNameOriginal&&this.lastName===this.lastNameOriginal}},computed:{userEditted(){return this.firstName===this.firstNameOriginal&&this.lastName===this.lastNameOriginal}}},c=d,u=s("2877"),m=s("9989"),h=s("f09f"),w=s("a370"),g=s("2c91"),f=s("0378"),p=s("27f9"),y=s("9c40"),P=s("24e8"),N=s("eebe"),b=s.n(N),C=Object(u["a"])(c,a,r,!1,null,null,null);t["default"]=C.exports;b()(C,"components",{QPage:m["a"],QCard:h["a"],QCardSection:w["a"],QSpace:g["a"],QForm:f["a"],QInput:p["a"],QBtn:y["a"],QDialog:P["a"]})}}]);