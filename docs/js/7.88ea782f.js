(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{"8b24":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"flex flex-center bg-primary"},[e.loggedIn?e._e():s("q-card",{staticClass:"bg-secondary text-white my-card",attrs:{dark:"",bordered:""}},[s("q-card-section",{staticClass:"text-center"},[s("div",{staticClass:"text-h6"},[e._v("Gospel Sounders Publications")]),s("div",{staticClass:"text-subtitle2"},[e._v("User Management")])]),s("q-separator",{attrs:{dark:"",inset:""}}),s("q-card-section",[s("q-tabs",{staticClass:"bg-secondary text-white shadow-2",attrs:{"inline-label":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[s("q-tab",{attrs:{name:"login",icon:"login",label:"Log in"}}),s("q-tab",{attrs:{name:"register",icon:"create",label:"Register"}})],1),"login"===e.tab?s("loginForm"):e._e(),"register"===e.tab?s("registrationForm"):e._e()],1)],1)],1)},r=[],i=(s("e6cf"),s("ddb0"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("q-toggle",{attrs:{color:"secondary"},on:{input:e.toggled},model:{value:e.localAccept,callback:function(t){e.localAccept=t},expression:"localAccept"}}),e._v("I\n  accept the\n  "),s("a",{staticClass:"text-underline text-italic",staticStyle:{"text-decoration":"underline",cursor:"pointer"},attrs:{clickable:""},on:{click:e.showTerms}},[e._v("terms and conditions")]),s("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:e.termsDialog,callback:function(t){e.termsDialog=t},expression:"termsDialog"}},[s("q-card",[s("q-card-section",{staticClass:"q-pt-none"},[""!==e.termsText?s("q-markdown",[e._v("\n          "+e._s(e.termsText)+"\n        ")]):e._e()],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Ok",color:"primary"}})],1)],1)],1)],1)}),n=[],o=s("cf57");const l=s("bc3a"),c=s("1712").to;var m={name:"terms",props:{accept:Boolean,main:Function},created(){this.myParent=this.main(),this.localAccept=this.accept},data(){return{localAccept:!1,myParent:null,termsText:"",termsDialog:!1}},methods:{async showTerms(){this.termsDialog=!0,this.working=!0,this.showCustom();let[e,t]=await c(l.get("https://raw.githubusercontent.com/GospelSounders/usermanagement/master/terms.md"));this.working=!1,t&&(this.termsText=t.data)},toggled(e){this.$nextTick((function(){this.myParent.changeAccept(e)}))},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:o["a"],color:"primary"},persistent:!0,ok:!1}),s=setInterval((()=>{!1===this.working&&(clearInterval(s),t.hide())}),500)}}},u=m,d=s("2877"),p=s("9564"),g=s("24e8"),h=s("f09f"),w=s("a370"),f=s("4b7e"),b=s("9c40"),y=s("7f67"),v=s("eebe"),k=s.n(v),q=Object(d["a"])(u,i,n,!1,null,null,null),x=q.exports;k()(q,"components",{QToggle:p["a"],QDialog:g["a"],QCard:h["a"],QCardSection:w["a"],QCardActions:f["a"],QBtn:b["a"]}),k()(q,"directives",{ClosePopup:y["a"]});var C=function(){var e=this,t=this,s=t.$createElement,a=t._self._c||s;return a("q-form",{staticClass:"q-gutter-md text-white",on:{submit:t.onSubmit,reset:t.onReset}},[a("q-input",{attrs:{filled:"",type:"email",label:"email",hint:"email","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your email address"},function(t){return e.isValidEmail()||"Invalid email address"}]},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),a("q-input",{attrs:{filled:"",type:"password",label:"Password","lazy-rules":"",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":t.passwordErrorMessage},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),a("div",[a("q-btn",{attrs:{label:"Submit",type:"submit",color:"primary"}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}})],1)],1)},_=[];s("bc3a");const I=s("1712").to,$=s("ff00"),T=s("547a").default;console.log("+++++++++++++++++++++++++"),console.log(T);var P={name:"loginForm",props:{},async created(){T.setSettings({TBURL:$["TB_URL"]});let[e,t]=await I(T.isLoggedIn());t&&window.location.assign("#/home")},data(){return{loggedin:!1,working:!1,email:"",password:"",passwordErrorMessage:""}},methods:{isValidEmail(){const e=/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/;return e.test(this.email)||"Invalid email"},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:o["a"],color:"primary"},persistent:!0,ok:!1}),s=setInterval((()=>{!1===this.working&&(clearInterval(s),t.hide())}),500)},async onSubmit(){T.setSettings({TBURL:$["TB_URL"]});$["TB_URL"];let e={username:this.email,password:this.password};this.working=!0,this.showCustom();let[t,s]=await I(T.login(e));if(this.working=!1,t)return this.loggedin=!1,this.$q.notify({type:"negative",message:"failed to log in"}),this.password="",void(this.passwordErrorMessage="wrong email/password");T.setToken(s),this.$q.notify({type:"positive",message:"log in successful"}),window.location.assign("#/home")},onReset(){this.email=null,this.password=null}}},R=P,Q=s("0378"),E=s("27f9"),A=Object(d["a"])(R,C,_,!1,null,null,null),S=A.exports;k()(A,"components",{QForm:Q["a"],QInput:E["a"],QBtn:b["a"]});var N=function(){var e=this,t=this,s=t.$createElement,a=t._self._c||s;return a("q-form",{ref:"userRegistrationForm",staticClass:"q-gutter-md text-white",on:{submit:t.createUser,reset:t.onReset}},[a("q-input",{attrs:{filled:"",type:"text",label:"first name",hint:"first name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your name"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.firstName,callback:function(e){t.firstName=e},expression:"firstName"}}),a("q-input",{attrs:{filled:"",type:"text",label:"last name",hint:"last name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your name"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.lastName,callback:function(e){t.lastName=e},expression:"lastName"}}),a("q-input",{attrs:{filled:"",type:"email",label:"email",hint:"email","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your email address"},function(t){return e.isValidEmail()||"Invalid email address"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),a("q-input",{attrs:{filled:"",type:"password",label:"Password","lazy-rules":"",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":t.passwordErrorMessage},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),a("q-input",{attrs:{filled:"",type:"password",label:"Password","lazy-rules":"",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":t.passwordErrorMessage},model:{value:t.cpassword,callback:function(e){t.cpassword=e},expression:"cpassword"}}),a("terms",{attrs:{accept:t.accept,main:t.main}}),a("div",[a("q-btn",{attrs:{label:"Submit",type:"submit",color:"primary"}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}})],1)],1)},z=[];s("bc3a");const B=s("1712").to,L=s("ff00"),U=s("547a").default;var F={name:"registrationForm",components:{terms:x},props:{},async created(){U.setSettings({TBURL:L["TB_URL"]}),U.setSettings(L);let[e,t]=await B(U.isLoggedIn());t&&window.location.assign("#/home")},data(){return{accept:!1,email:"",firstName:"",lastName:"",password:"",cpassword:"",passwordErrorMessage:"",users:[]}},methods:{changeAccept(e){this.accept=e},submit(){this.$refs.userRegistrationForm.submit()},main(){return this},isValidEmail(){const e=/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/;return e.test(this.email)||"Invalid email"},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:o["a"],color:"primary"},persistent:!0,ok:!1}),s=setInterval((()=>{!1===this.working&&(clearInterval(s),t.hide())}),500)},async createUser(){return new Promise((async(e,t)=>{if(!0!==this.accept)return this.$q.notify({color:"red-5",textColor:"white",icon:"warning",message:"You need to accept the license and terms first"}),e(!1);if(this.password!==this.cpassword)return this.cpassword="",this.passwordErrorMessage="Passwords don't match",this.$q.notify({type:"negative",message:"Passwords don't match"}),e(!1);this.working=!0,this.showCustom();let[s,a]=await B(U.createUser({user:this.email,firstName:this.firstName,lastName:this.lastName,password:this.password},!0));this.working=!1,s?(this.$q.notify({type:"negative",message:s.msg||s}),e(!1)):(this.users.push(a),this.$q.notify({type:"positive",message:"Registration successful"}))}))},onReset(){this.email=null,this.firstName=null,this.lastName=null,this.password=null,this.cpassword=null,this.accept=!1}}},M=F,O=Object(d["a"])(M,N,z,!1,null,null,null),Z=O.exports;k()(O,"components",{QForm:Q["a"],QInput:E["a"],QToggle:p["a"],QBtn:b["a"]});s("bc3a");const D=s("1712").to,j=s("ff00"),V=s("547a").default;var G={name:"PageIndex",components:{terms:x,loginForm:S,registrationForm:Z},async created(){V.setSettings({TBURL:j["TB_URL"]}),this.working=!0,this.showCustom();let[e,t]=await D(V.isLoggedIn());this.working=!1,t?window.location.assign("#/home"):this.loggedIn=!1},data(){return{tab:"login",name:null,age:null,loggedIn:!0,accept:!1,working:!1}},methods:{showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:o["a"],color:"primary"},persistent:!0,ok:!1}),s=setInterval((()=>{!1===this.working&&(clearInterval(s),t.hide())}),500)},main(){return this},changeAccept(e){this.accept=e},onSubmit(){console.log(this.accept),!0!==this.accept?this.$q.notify({color:"red-5",textColor:"white",icon:"warning",message:"You need to accept the license and terms first"}):this.$q.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"Submitted"})},onReset(){this.name=null,this.age=null,this.accept=!1}}},J=G,Y=s("9989"),H=s("eb85"),K=s("429b"),W=s("7460"),X=Object(d["a"])(J,a,r,!1,null,null,null);t["default"]=X.exports;k()(X,"components",{QPage:Y["a"],QCard:h["a"],QCardSection:w["a"],QSeparator:H["a"],QTabs:K["a"],QTab:W["a"]})}}]);