(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{1:function(e,t){},10:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"547a":function(e,t,n){"use strict";n.r(t);n("e6cf"),n("ddb0");var o=n("9523"),i=n.n(o);const s=n("1712").to,a=n("bc3a"),r=n("1232").default,l=n("4556"),c=n("e350").default;console.log(c);class p extends c{constructor(){var e;super(),e=this,i()(this,"settings",{}),i()(this,"setSettings",(e=>{for(let t in e){let n=e[t];this.settings[t]=n}})),i()(this,"setToken",(e=>{let t=e.token,n=e.refreshToken;window.localStorage.setItem("tbTokenGSAC",t),window.localStorage.setItem("tbRefreshTokenGSAC",n)})),i()(this,"logout",(()=>{window.localStorage.removeItem("tbTokenGSAC"),window.localStorage.removeItem("tbRefreshTokenGSAC"),this.jwt_token=null})),i()(this,"login",(async function(t){return new Promise((async function(n,o){let i=`${e.settings.TBURL}/auth/login`,[r,l]=await s(a.post(i,t));return r?o(r):n(l.data)}))})),i()(this,"getToken",(async function(t,n){return new Promise((async function(t,o){let i=`${e.settings.TBURL}/auth/token`,[r,l]=await s(a.post(i,{refreshToken:n},{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+n}}));return r?o(r):t(l.data)}))})),i()(this,"isLoggedIn",(async function(){return new Promise((async function(t,n){let o=localStorage.getItem("tbTokenGSAC");if(!o)return n("missing token");let i=r(o);console.log(i),e.userId=i.userId,e.jwt_token=o;let a=i.exp;if(!a)return n("missing token expiry");let l=localStorage.getItem("tbRefreshTokenGSAC");a=parseInt(a),(new Date).getTime();{let[t,i]=await s(e.getToken(o,l));if(t)return n("could not find token");e.setToken(i),o=i.token}return t(o)}))})),i()(this,"fetchRoles",(async function(){return new Promise((async function(t,n){let[o,i]=await s(e.sendSaveTeletry({type:"roles",action:"get"}));if(o)return n(o);t(i)}))})),i()(this,"fetchProjects",(async function(){return new Promise((async function(t,n){let[o,i]=await s(e.sendSaveTeletry({type:"projects",action:"get"}));if(o)return n(o);t(i)}))})),i()(this,"whoAmI",(async function(){return new Promise((async function(t,n){let[o,i]=await s(e.readUserData());if(console.log("WHOAMI"),o)return n(o);t(i)}))})),i()(this,"fetchUsers",(async function(){return new Promise((async function(t,n){let[o,i]=await s(e.whoAmI());if(o)return n(o);let r,l=i.authority;if("TENANT_ADMIN"===l){let t=`${e.settings.TBURL}/tenant/customers?customerTitle=GS Publications`;if([o,i]=await s(a.get(t,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+e.jwt_token}})),o)return n(o);r=i.data.id.id}else console.log("i am a customer...."),console.log(i),r=i.customerId.id;if(console.log("CUSTOMER ID",r),[o,i]=await s(e.sendSaveTeletry({type:"users",action:"get",customerId:r})),o)return n(o.msg||o);t(i)}))})),i()(this,"createRole",(async function(t){return new Promise((async function(n,o){let[i,a]=await s(e.sendSaveTeletry({type:"roles",action:"create",role:t}));if(i)return o(i);n(a)}))})),i()(this,"createUser",(async function(t,n){let{user:o,firstName:i,lastName:a,password:r}=t;return console.log("PPPPPPPPPPPPPPPPPPPPp"),new Promise((async function(t,l){console.log("step1...");let[c,p]=await s(e.sendSaveTeletry({type:"users",action:"create",user:o,firstName:i,lastName:a,password:r},n));if(c)return console.log("REJECTED========"),console.log(c),l(c);if(n){if(console.log("NEVER WAITING"),[c,p]=await s(e.checkSuccessfulCreateUser(o,r)),c)return l(c);t(p)}else{console.log("result from creating user");let n=JSON.parse(JSON.stringify(p));if(console.log(p),0===Object.keys(p).length){if([c,p]=await s(e.login({username:o,password:r})),c)return l("Registration failed. Please try submitting the form again");t({})}else t(n)}}))})),i()(this,"checkSuccessfulCreateUser",(async function(t,n){return new Promise((async function(o,i){let a=(new Date).getTime();console.log("starting for sure...");const r=async function(){console.log("here.....");let c=l({length:20,type:"url-safe"});return e.once(c,r),new Promise((async function(l,p){let[u,f]=await s(e.login({username:t,password:n}));if(u){console.log(u.data);let n=(new Date).getTime(),o=n-a;o<=1e4?e.emit(c):(e.removeListener(c,r),i(`Error creating account. Probably ${t} already exists`),p("Timed out"))}if(void 0!==f)return console.log(f),e.removeListener(c,r),l(f.data),o(f.data);{let t=(new Date).getTime(),n=t-a;n<=1e4?e.emit(c):(e.removeListener(c,r),i("Error creating account. Probably ${user} already exists"),p("Timed out"))}}))};await s(r())}))})),i()(this,"deleteUser",(async function(t){return new Promise((async function(n,o){console.log("STARGINT TO DELETE");let[i,a]=await s(e.sendSaveTeletry({type:"users",action:"delete",user:t}));if(i)return console.log("REJECTED========"),console.log(i),o(i);let r=JSON.parse(JSON.stringify(a));console.log(a),n(r)}))})),i()(this,"getActivationLink",(async function(t,n){return new Promise((async function(o,i){let r=`${e.settings.TBURL}/user/${t}/activationLink`,[l,c]=await s(a.get(`${e.settings.JSONPROXY}?path=${r}`,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+n}}));if(l)return i(l);o(c.data)}))})),i()(this,"createProject",(async function(t,n,o){return new Promise((async function(n,o){let[i,a]=await s(e.sendSaveTeletry({type:"projects",action:"create",project:t}));if(console.log("adhkjashdkhasdk"),i)return o(i);console.log("RETURNED..."),console.log(a),n(a)}))})),i()(this,"deleteRole",(async function(t){return new Promise((async function(n,o){let[i,a]=await s(e.sendSaveTeletry({type:"roles",action:"delete",role:t}));if(i)return o(i);n(a)}))})),i()(this,"deleteProject",(async function(t){return new Promise((async function(n,o){let[i,a]=await s(e.sendSaveTeletry({type:"projects",action:"delete",project:t}));if(i)return o(i);n(a)}))})),i()(this,"createApplication",(async function(t){return new Promise((async function(n,o){let[i,a]=await s(e.sendSaveTeletry({type:"applications",action:"create",application:t}));if(console.log("adhkjashdkhasdk"),i)return o(i);console.log("RETURNED..."),console.log(a),n(a)}))})),i()(this,"fetchApplications",(async function(){return new Promise((async function(t,n){let[o,i]=await s(e.sendSaveTeletry({type:"applications",action:"get"}));if(o)return n(o);t(i)}))})),i()(this,"deleteApplication",(async function(t){return new Promise((async function(n,o){let[i,a]=await s(e.sendSaveTeletry({type:"applications",action:"delete",application:t}));if(i)return o(i);n(a)}))})),i()(this,"readUserData",(async function(){return new Promise((async function(t,n){let o=`${e.settings.TBURL}/auth/user`,[i,r]=await s(a.get(o,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+e.jwt_token}}));return i?n(i):t(r.data)}))})),i()(this,"sendSaveTeletry",(async function(t,n=!1){return t.userId||(t.userId=e.userId),t.jwt_token||e.jwt_token&&(t.jwt_token=e.jwt_token),t.rqId||(t.rqId=l({length:20,type:"url-safe"})),console.log("step2"),console.log({data:t}),new Promise((async function(o,i){let r=e.settings.PUBLIC_DEVICE_ACCESS_TOKEN;console.log(e.settings);let c=e.settings.CORS_PROXY,p=`${e.settings.TBURL}/v1/${r}/telemetry`;console.log(t);let[u,f]=await s(a.post(`${c}/${p}`,t,{headers:{"Content-Type":"application/json"}}));if(console.log("ERRED......"),console.log(u),console.log(f),u)return i(u);if(n)return console.log("NO WAITING.."),o(!0);let d=t.rqId,g=(new Date).getTime();const h=async function(){return new Promise((async function(t,n){let[a,r]=await s(e.readUserData()),c=l({length:20,type:"url-safe"});if(e.once(c,h),a)console.log(a.status),console.log(a.response.data.status),console.log(a.data),console.log(a),e.removeListener(c,h),401===a.response.data.status?(console.log("---------160"),t({}),o({})):(console.log("---------1601"),n(a),i(a));else if(void 0===r.additionalInfo)i("Unknown error occured"),n("Unknown error occured");else{let s=r.additionalInfo.responses;if(s&&s[d]){console.log("---------167");let a=s[d];return console.log(a),a.msg.error?(e.removeListener(c,h),n(a.msg.error),i(a.msg.error)):(console.log("returned...."),console.log(a.msg),o(a.msg),t(!0),console.log("after resolve....."),e.removeListener(c,h),o(a.msg))}{let t=(new Date).getTime(),o=t-g;o<=12e4?(console.log(o,d),e.emit(c)):(e.removeListener(c,h),i("timed out"),n("timed out"))}}}))};await s(h())}))}))}}const u=new p;t["default"]=u},"5c23":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{attrs:{padding:""}},[n("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:e.createApplicationDialog,callback:function(t){e.createApplicationDialog=t},expression:"createApplicationDialog"}},[n("q-card",{staticClass:"bg-secondary text-white"},[n("q-card-section",{staticClass:"text-center text-h3"},[n("div",{staticClass:"text-subtitle2"},[e._v("Create New Application")])]),n("q-separator",{attrs:{dark:""}}),n("q-card-section",[n("q-form",{ref:"newApplicationForm",staticClass:"col q-gutter-md text-white",on:{submit:e.createApplication,reset:e.onReset}},[n("q-input",{attrs:{filled:"",type:"text",label:"Application Name",hint:"Application Name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter application name"}]},on:{input:e.repoNameFromApplication,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.application,callback:function(t){e.application=t},expression:"application"}}),n("q-select",{attrs:{clearable:"","use-input":"",filled:"",options:e.applications,label:"Application","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please select application"}]},on:{input:e.repoNameFromApplication,filter:e.filterFn},model:{value:e.application,callback:function(t){e.application=t},expression:"application"}}),n("q-input",{attrs:{disable:"",filled:"",type:"text",label:"Repo",hint:"Repo","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please application name"}]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.repo,callback:function(t){e.repo=t},expression:"repo"}}),n("div",{staticClass:"col"},[n("q-btn",{attrs:{label:"Create",type:"submit",color:"primary"}}),n("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}})],1)],1)],1)],1)],1),n("div",{staticClass:"row"},[n("q-list",{staticClass:"col",attrs:{bordered:"",highlight:""}},[n("q-item-label",{attrs:{header:""}},[n("div",{staticClass:"row"},[e._v("\n          Applications\n          "),n("q-space"),n("q-btn",{attrs:{flat:""}},[n("q-icon",{attrs:{color:"primary",name:"refresh",side:""},on:{click:function(t){return e.fetchApplications()}}})],1),n("q-btn",{attrs:{flat:""}},[n("q-icon",{attrs:{color:"primary",name:"add_circle",side:""},on:{click:function(t){e.createApplicationDialog=!0}}})],1)],1)]),e._l(e.applications,(function(t,o){return n("q-item",{key:o},[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{color:"primary",name:"security"}})],1),n("q-item-section",[e._v(e._s(t))]),n("q-item-section",{attrs:{side:"",clickable:""},on:{click:function(n){return e.deleteApplication(t)}}},[n("q-icon",{attrs:{name:"delete",color:"red"}})],1)],1)}))],2)],1)],1)},i=[],s=(n("c975"),n("26e9"),n("e6cf"),n("5319"),n("ddb0"),n("cf57"));n("bc3a");const a=n("1712").to,r=n("ff00"),l=r,c=n("547a").default,{Octokit:p}=n("1af2"),u=n("e350").default,f=new u;var d={name:"Applications",components:{},async created(){f.on("error",this.loadList),f.emit("error"),c.setSettings({TBURL:r["TB_URL"]}),c.setSettings(r);let[e,t]=await a(c.isLoggedIn());e?window.location.assign("#/"):[e,t]=await a(this.fetchApplications())},beforeDestroy(){f.removeListener("error",this.loadList)},data(){return{application:"",repo:"",applications:[],createApplicationDialog:!1,applications:[],allApplications:[],application:""}},methods:{filterFn(e,t){t(""!==e?()=>{const t=e.toLowerCase();this.applications=this.allApplications.filter((e=>e.toLowerCase().indexOf(t)>-1))}:()=>{this.applications=this.allApplications})},onReset(){this.application="",this.application=""},submit(){this.$refs.newApplicationForm.submit()},alert(e){alert(e)},async createApplication(){return new Promise((async(e,t)=>{if(""===this.application)return this.$q.notify({type:"negative",message:"Application cannot be blank"}),t("application cannot be blank");this.working=!0,this.showCustom("creating application");let[n,o]=await a(c.createApplication(this.application));this.working=!1,n?(this.$q.notify({type:"negative",message:n.msg||n}),e(!1)):(console.log(o),this.applications=o.applications,this.application="")}))},async fetchApplications(){return new Promise((async(e,t)=>{this.working=!0,this.showCustom("fetching applications");let[n,o]=await a(c.fetchApplications());this.working=!1,n?(this.$q.notify({type:"negative",message:n}),e(!1)):(this.applications=o.applications,e(o.applications))}))},async deleteApplication(e){return new Promise((async(t,n)=>{let[o,i]=await a(this.confirm(`Are you sure you want to delete ${e}`,"Delete Application"));return o?t(!1):(this.working=!0,this.showCustom("deleting application"),[o,i]=await a(c.deleteApplication(e)),this.working=!1,o?(console.log(o),this.$q.notify({type:"negative",message:o.msg||o}),t(!1)):(this.applications=i.applications,void t(i.applications)))}))},async confirm(e,t="Confirm"){return new Promise(((n,o)=>{this.$q.dialog({title:t,message:e,cancel:!0,persistent:!0}).onOk((()=>n(!0))).onOk((()=>n(!0))).onCancel((()=>o(!0))).onDismiss((()=>o(!0)))}))},showCustom(e="",t="",n=0){const o=this.$q.dialog({title:e,message:t,progress:{spinner:s["a"],color:"primary"},persistent:!0,ok:!1});let i,a,r=n;o.update({message:`${r} secs`});const l=()=>{clearInterval(i),clearInterval(a),o.hide()};a=setInterval((()=>{n>0?(r--,0===r&&l()):r++,o.update({message:`${r} secs`})}),1e3),i=setInterval((()=>{!1===this.working&&l()}),500)},async loadList(){return new Promise((async(e,t)=>{this.working=!0,this.showCustom("Loading");l.CORS_PROXY,l.LISTURL;const n=new p({});let o=l.LISTURL.split("/").reverse(),i=o[0],s=o[2],r=o[3],[c,u]=await a(n.request(`GET /repos/${r}/${s}/contents/${i}`,{owner:r,repo:s,path:i}));this.working=!1,c?(this.working=!0,this.showCustom("Error. Going to refresh.","",5),setTimeout((()=>{this.working=!1,f.emit("error")}),5e3)):this.listLoaded(JSON.parse(atob(u.data.content)))}))},listLoaded(e){let t=[];for(let n in e){e[n];t.push(n)}this.allApplications=[...t],this.applications=[...this.allApplications]},repoNameFromApplication(e){this.repoNameFromApplication(e)},repoNameFromApplication(e){this.repo=`${(this.application||"").toLowerCase().replace(".","-").replace(" ","-")}.${(this.application||"").toLowerCase().replace(".","-").replace(" ","-")}.gsp`}}},g=d,h=n("2877"),m=n("9989"),y=n("24e8"),w=n("f09f"),k=n("a370"),T=n("eb85"),v=n("0378"),P=n("27f9"),b=n("ddd8"),A=n("9c40"),S=n("1c1c"),C=n("0170"),I=n("2c91"),L=n("0016"),R=n("66e5"),q=n("4074"),E=n("eebe"),N=n.n(E),O=Object(h["a"])(g,o,i,!1,null,null,null);t["default"]=O.exports;N()(O,"components",{QPage:m["a"],QDialog:y["a"],QCard:w["a"],QCardSection:k["a"],QSeparator:T["a"],QForm:v["a"],QInput:P["a"],QSelect:b["a"],QBtn:A["a"],QList:S["a"],QItemLabel:C["a"],QSpace:I["a"],QIcon:L["a"],QItem:R["a"],QItemSection:q["a"]})},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},e350:function(e,t,n){"use strict";n.r(t);n("c975"),n("a434");class o{constructor(){this.events={}}on(e,t){return"object"!==typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){if("object"===typeof this.events[e]){const n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}emit(e,...t){"object"===typeof this.events[e]&&this.events[e].forEach((e=>e.apply(this,t)))}once(e,t){const n=this.on(e,((...e)=>{n(),t.apply(this,e)}))}}t["default"]=o},ff00:function(e){e.exports=JSON.parse('{"TB_URL":"https://demo.thingsboard.io/api","PUBLIC_DEVICE_ACCESS_TOKEN":"9sE9Z86OdYsynyCJKjnq","CORS_PROXY":"https://cors.cseco.co.ke","JSONPROXY":"https://jsonproxy.cseco.co.ke","LISTURL":"https://raw.githubusercontent.com/GospelSounders/applications-list/master/applications.json"}')}}]);