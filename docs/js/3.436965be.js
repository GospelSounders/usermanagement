(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{1:function(e,t){},10:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"547a":function(e,t,n){"use strict";n.r(t);n("e6cf"),n("ddb0");var o=n("9523"),s=n.n(o);const a=n("1712").to,r=n("bc3a"),i=n("1232").default,c=n("4556"),l=n("e350").default;console.log(l);class u extends l{constructor(){var e;super(),e=this,s()(this,"settings",{}),s()(this,"setSettings",(e=>{for(let t in e){let n=e[t];this.settings[t]=n}})),s()(this,"setToken",(e=>{let t=e.token,n=e.refreshToken;window.localStorage.setItem("tbTokenGSAC",t),window.localStorage.setItem("tbRefreshTokenGSAC",n)})),s()(this,"logout",(()=>{window.localStorage.removeItem("tbTokenGSAC"),window.localStorage.removeItem("tbRefreshTokenGSAC"),this.jwt_token=null})),s()(this,"login",(async function(t){return new Promise((async function(n,o){let s=`${e.settings.TBURL}/auth/login`,[i,c]=await a(r.post(s,t));return i?o(i):n(c.data)}))})),s()(this,"getToken",(async function(t,n){return new Promise((async function(t,o){let s=`${e.settings.TBURL}/auth/token`,[i,c]=await a(r.post(s,{refreshToken:n},{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+n}}));return i?o(i):t(c.data)}))})),s()(this,"isLoggedIn",(async function(){return new Promise((async function(t,n){let o=localStorage.getItem("tbTokenGSAC");if(!o)return n("missing token");let s=i(o);console.log(s),e.userId=s.userId,e.jwt_token=o;let r=s.exp;if(!r)return n("missing token expiry");let c=localStorage.getItem("tbRefreshTokenGSAC");r=parseInt(r),(new Date).getTime();{let[t,s]=await a(e.getToken(o,c));if(t)return n("could not find token");e.setToken(s),o=s.token}return t(o)}))})),s()(this,"fetchRoles",(async function(){return new Promise((async function(t,n){let[o,s]=await a(e.sendSaveTeletry({type:"roles",action:"get"}));if(o)return n(o);t(s)}))})),s()(this,"fetchProjects",(async function(){return new Promise((async function(t,n){let[o,s]=await a(e.sendSaveTeletry({type:"projects",action:"get"}));if(o)return n(o);t(s)}))})),s()(this,"whoAmI",(async function(){return new Promise((async function(t,n){let[o,s]=await a(e.readUserData());if(console.log("WHOAMI"),o)return n(o);t(s)}))})),s()(this,"fetchUsers",(async function(){return new Promise((async function(t,n){let[o,s]=await a(e.whoAmI());if(o)return n(o);let i,c=s.authority;if("TENANT_ADMIN"===c){let t=`${e.settings.TBURL}/tenant/customers?customerTitle=GS Publications`;if([o,s]=await a(r.get(t,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+e.jwt_token}})),o)return n(o);i=s.data.id.id}else console.log("i am a customer...."),console.log(s),i=s.customerId.id;if(console.log("CUSTOMER ID",i),[o,s]=await a(e.sendSaveTeletry({type:"users",action:"get",customerId:i})),o)return n(o.msg||o);t(s)}))})),s()(this,"createRole",(async function(t){return new Promise((async function(n,o){let[s,r]=await a(e.sendSaveTeletry({type:"roles",action:"create",role:t}));if(s)return o(s);n(r)}))})),s()(this,"createUser",(async function(t,n){let{user:o,firstName:s,lastName:r,password:i}=t;return console.log("PPPPPPPPPPPPPPPPPPPPp"),new Promise((async function(t,c){console.log("step1...");let[l,u]=await a(e.sendSaveTeletry({type:"users",action:"create",user:o,firstName:s,lastName:r,password:i},n));if(l)return console.log("REJECTED========"),console.log(l),c(l);if(n){if(console.log("NEVER WAITING"),[l,u]=await a(e.checkSuccessfulCreateUser(o,i)),l)return c(l);t(u)}else{console.log("result from creating user");let n=JSON.parse(JSON.stringify(u));if(console.log(u),0===Object.keys(u).length){if([l,u]=await a(e.login({username:o,password:i})),l)return c("Registration failed. Please try submitting the form again");t({})}else t(n)}}))})),s()(this,"checkSuccessfulCreateUser",(async function(t,n){return new Promise((async function(o,s){let r=(new Date).getTime();console.log("starting for sure...");const i=async function(){console.log("here.....");let l=c({length:20,type:"url-safe"});return e.once(l,i),new Promise((async function(c,u){let[f,d]=await a(e.login({username:t,password:n}));if(f){console.log(f.data);let n=(new Date).getTime(),o=n-r;o<=1e4?e.emit(l):(e.removeListener(l,i),s(`Error creating account. Probably ${t} already exists`),u("Timed out"))}if(void 0!==d)return console.log(d),e.removeListener(l,i),c(d.data),o(d.data);{let t=(new Date).getTime(),n=t-r;n<=1e4?e.emit(l):(e.removeListener(l,i),s("Error creating account. Probably ${user} already exists"),u("Timed out"))}}))};await a(i())}))})),s()(this,"deleteUser",(async function(t){return new Promise((async function(n,o){console.log("STARGINT TO DELETE");let[s,r]=await a(e.sendSaveTeletry({type:"users",action:"delete",user:t}));if(s)return console.log("REJECTED========"),console.log(s),o(s);let i=JSON.parse(JSON.stringify(r));console.log(r),n(i)}))})),s()(this,"getActivationLink",(async function(t,n){return new Promise((async function(o,s){let i=`${e.settings.TBURL}/user/${t}/activationLink`,[c,l]=await a(r.get(`${e.settings.JSONPROXY}?path=${i}`,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+n}}));if(c)return s(c);o(l.data)}))})),s()(this,"createProject",(async function(t,n,o){return new Promise((async function(n,o){let[s,r]=await a(e.sendSaveTeletry({type:"projects",action:"create",project:t}));if(console.log("adhkjashdkhasdk"),s)return o(s);console.log("RETURNED..."),console.log(r),n(r)}))})),s()(this,"deleteRole",(async function(t){return new Promise((async function(n,o){let[s,r]=await a(e.sendSaveTeletry({type:"roles",action:"delete",role:t}));if(s)return o(s);n(r)}))})),s()(this,"deleteProject",(async function(t){return new Promise((async function(n,o){let[s,r]=await a(e.sendSaveTeletry({type:"projects",action:"delete",project:t}));if(s)return o(s);n(r)}))})),s()(this,"createApplication",(async function(t){return new Promise((async function(n,o){let[s,r]=await a(e.sendSaveTeletry({type:"applications",action:"create",application:t}));if(console.log("adhkjashdkhasdk"),s)return o(s);console.log("RETURNED..."),console.log(r),n(r)}))})),s()(this,"fetchApplications",(async function(){return new Promise((async function(t,n){let[o,s]=await a(e.sendSaveTeletry({type:"applications",action:"get"}));if(o)return n(o);t(s)}))})),s()(this,"deleteApplication",(async function(t){return new Promise((async function(n,o){let[s,r]=await a(e.sendSaveTeletry({type:"applications",action:"delete",application:t}));if(s)return o(s);n(r)}))})),s()(this,"readUserData",(async function(){return new Promise((async function(t,n){let o=`${e.settings.TBURL}/auth/user`,[s,i]=await a(r.get(o,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+e.jwt_token}}));return s?n(s):t(i.data)}))})),s()(this,"sendSaveTeletry",(async function(t,n=!1){return t.userId||(t.userId=e.userId),t.jwt_token||e.jwt_token&&(t.jwt_token=e.jwt_token),t.rqId||(t.rqId=c({length:20,type:"url-safe"})),console.log("step2"),console.log({data:t}),new Promise((async function(o,s){let i=e.settings.PUBLIC_DEVICE_ACCESS_TOKEN;console.log(e.settings);let l=e.settings.CORS_PROXY,u=`${e.settings.TBURL}/v1/${i}/telemetry`;console.log(t);let[f,d]=await a(r.post(`${l}/${u}`,t,{headers:{"Content-Type":"application/json"}}));if(console.log("ERRED......"),console.log(f),console.log(d),f)return s(f);if(n)return console.log("NO WAITING.."),o(!0);let g=t.rqId,m=(new Date).getTime();const p=async function(){return new Promise((async function(t,n){let[r,i]=await a(e.readUserData()),l=c({length:20,type:"url-safe"});if(e.once(l,p),r)console.log(r.status),console.log(r.response.data.status),console.log(r.data),console.log(r),e.removeListener(l,p),401===r.response.data.status?(console.log("---------160"),t({}),o({})):(console.log("---------1601"),n(r),s(r));else if(void 0===i.additionalInfo)s("Unknown error occured"),n("Unknown error occured");else{let a=i.additionalInfo.responses;if(a&&a[g]){console.log("---------167");let r=a[g];return console.log(r),r.msg.error?(e.removeListener(l,p),n(r.msg.error),s(r.msg.error)):(console.log("returned...."),console.log(r.msg),o(r.msg),t(!0),console.log("after resolve....."),e.removeListener(l,p),o(r.msg))}{let t=(new Date).getTime(),o=t-m;o<=12e4?(console.log(o,g),e.emit(l)):(e.removeListener(l,p),s("timed out"),n("timed out"))}}}))};await a(p())}))}))}}const f=new u;t["default"]=f},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},bc13:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"bg-secondary",attrs:{padding:""}},[n("q-table",{attrs:{grid:"","card-container-class":e.cardContainerClass,data:e.data,columns:e.columns,"row-key":"name","hide-header":"","hide-bottom":""},scopedSlots:e._u([{key:"item",fn:function(t){return[n("div",{staticClass:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},[n("q-card",{staticClass:"bg-white"},[n("q-card-section",{staticClass:"text-left text-h6"},[n("strong",[e._v(e._s(t.row.name))])]),n("q-card-section",{staticClass:"flex flex-center"},[n("q-card",{staticClass:"bg-primary",staticStyle:{width:"80vw"}},[n("q-card-section",{staticClass:"text-center"},[n("q-icon",{staticStyle:{"font-size":"6em"},attrs:{name:"help",color:"white"}})],1),n("q-card-section",{staticClass:"flex flex-center"},[n("div",[e._v(e._s(t.row.calories)+" g")])])],1)],1)],1)],1)]}}])}),""!==e.helpText?n("q-markdown",[e._v("\n      Home page...\n"+e._s(e.helpText)+"\n")]):e._e()],1)},s=[];n("4e82"),n("e6cf"),n("ddb0"),n("cf57");const a=n("bc3a"),r=n("1712").to,i=n("ff00"),c=n("547a").default,l=["Frozen Yogurt","Ice cream sandwich","Eclair","Cupcake","Gingerbread","Jelly bean","Lollipop","Honeycomb","Donut","KitKat"],u=[];l.forEach((e=>{for(let t=0;t<24;t++)u.push({name:e+" ("+t+")",calories:20+Math.ceil(50*Math.random())})})),u.sort((()=>-1+Math.floor(3*Math.random())));var f={name:"Help",components:{},computed:{cardContainerClass(){if(this.$q.screen.gt.xs)return"grid-masonry grid-masonry--"+(this.$q.screen.gt.sm?"3":"2")},rowsPerPageOptions(){return this.$q.screen.gt.xs?this.$q.screen.gt.sm?[3,6,9]:[3,6]:[3]}},async created(){c.setSettings({TBURL:i["TB_URL"]}),c.setSettings(i);let[e,t]=await r(c.isLoggedIn());e?window.location.assign("#/"):([e,t]=await r(a.get("https://raw.githubusercontent.com/GospelSounders/usermanagement/master/README.md")),t&&(this.helpText=t.data),console.log(this.helpText))},data(){return{helpText:"",columns:[{name:"name",label:"Name",field:"name"},{name:"calories",label:"Calories (g)",field:"calories"}],data:u}},methods:{}},d=f,g=n("2877"),m=n("9989"),p=n("eaac"),h=n("f09f"),y=n("a370"),w=n("0016"),T=n("eebe"),P=n.n(T),S=Object(g["a"])(d,o,s,!1,null,null,null);t["default"]=S.exports;P()(S,"components",{QPage:m["a"],QTable:p["a"],QCard:h["a"],QCardSection:y["a"],QIcon:w["a"]})},e350:function(e,t,n){"use strict";n.r(t);n("c975"),n("a434");class o{constructor(){this.events={}}on(e,t){return"object"!==typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){if("object"===typeof this.events[e]){const n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}emit(e,...t){"object"===typeof this.events[e]&&this.events[e].forEach((e=>e.apply(this,t)))}once(e,t){const n=this.on(e,((...e)=>{n(),t.apply(this,e)}))}}t["default"]=o},ff00:function(e){e.exports=JSON.parse('{"TB_URL":"https://demo.thingsboard.io/api","PUBLIC_DEVICE_ACCESS_TOKEN":"9sE9Z86OdYsynyCJKjnq","CORS_PROXY":"https://cors.cseco.co.ke","JSONPROXY":"https://jsonproxy.cseco.co.ke","LISTURL":"https://raw.githubusercontent.com/GospelSounders/applications-list/master/applications.json"}')}}]);