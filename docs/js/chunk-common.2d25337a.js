(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{1:function(e,t){},10:function(e,t){},2:function(e,t){},3:function(e,t){},"37c0":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-item",{attrs:{clickable:"",tag:"a",target:"_blank",href:e.link}},[e.icon?n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:e.icon}})],1):e._e(),n("q-item-section",[n("q-item-label",[e._v(e._s(e.title))]),n("q-item-label",{attrs:{caption:""}},[e._v("\n      "+e._s(e.caption)+"\n    ")])],1)],1)},o=[],a={name:"EssentialLink",props:{title:{type:String,required:!0},caption:{type:String,default:""},link:{type:String,default:"#"},icon:{type:String,default:""}}},s=a,r=n("2877"),c=n("66e5"),l=n("4074"),p=n("0016"),u=n("0170"),f=n("eebe"),d=n.n(f),m=Object(r["a"])(s,i,o,!1,null,null,null);t["a"]=m.exports;d()(m,"components",{QItem:c["a"],QItemSection:l["a"],QIcon:p["a"],QItemLabel:u["a"]})},4:function(e,t){},5:function(e,t){},"547a":function(e,t,n){"use strict";n.r(t);n("e01a"),n("e6cf"),n("ddb0");var i=n("9523"),o=n.n(i);const a=n("1712").to,s=n("bc3a"),r=n("1232").default,c=n("4556"),l=n("e350").default;console.log(l);class p extends l{constructor(){var e;super(),e=this,o()(this,"settings",{}),o()(this,"setSettings",(e=>{for(let t in e){let n=e[t];this.settings[t]=n}})),o()(this,"setToken",(e=>{let t=e.token,n=e.refreshToken;window.localStorage.setItem("tbTokenGSAC",t),window.localStorage.setItem("tbRefreshTokenGSAC",n)})),o()(this,"logout",(()=>{window.localStorage.removeItem("tbTokenGSAC"),window.localStorage.removeItem("tbRefreshTokenGSAC"),this.jwt_token=null})),o()(this,"login",(async function(t){return new Promise((async function(n,i){let o=`${e.settings.TBURL}/auth/login`,[r,c]=await a(s.post(o,t));return r?i(r):n(c.data)}))})),o()(this,"getToken",(async function(t,n){return new Promise((async function(t,i){let o=`${e.settings.TBURL}/auth/token`,[r,c]=await a(s.post(o,{refreshToken:n},{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+n}}));return r?i(r):t(c.data)}))})),o()(this,"isLoggedIn",(async function(){return new Promise((async function(t,n){let i=localStorage.getItem("tbTokenGSAC");if(!i)return n("missing token");let o=r(i);console.log(o),e.userId=o.userId,e.jwt_token=i;let s=o.exp;if(!s)return n("missing token expiry");let c=localStorage.getItem("tbRefreshTokenGSAC");s=parseInt(s),(new Date).getTime();{let[t,o]=await a(e.getToken(i,c));if(t)return n("could not find token");e.setToken(o),i=o.token}return t(i)}))})),o()(this,"fetchRoles",(async function(){return new Promise((async function(t,n){let[i,o]=await a(e.sendSaveTeletry({type:"roles",action:"get"}));if(i)return n(i);t(o)}))})),o()(this,"fetchProjects",(async function(){return new Promise((async function(t,n){let[i,o]=await a(e.sendSaveTeletry({type:"projects",action:"get"}));if(i)return n(i);t(o)}))})),o()(this,"whoAmI",(async function(){return new Promise((async function(t,n){let[i,o]=await a(e.readUserData());if(console.log("WHOAMI"),i)return n(i);t(o)}))})),o()(this,"fetchUsers",(async function(){return new Promise((async function(t,n){let[i,o]=await a(e.whoAmI());if(i)return n(i);let r,c=o.authority;if("TENANT_ADMIN"===c){let t=`${e.settings.TBURL}/tenant/customers?customerTitle=GS Publications`;if([i,o]=await a(s.get(t,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+e.jwt_token}})),i)return n(i);r=o.data.id.id}else console.log("i am a customer...."),console.log(o),r=o.customerId.id;if(console.log("CUSTOMER ID",r),[i,o]=await a(e.sendSaveTeletry({type:"users",action:"get",customerId:r})),i)return n(i.msg||i);t(o)}))})),o()(this,"createRole",(async function(t){return new Promise((async function(n,i){let[o,s]=await a(e.sendSaveTeletry({type:"roles",action:"create",role:t}));if(o)return i(o);n(s)}))})),o()(this,"createUser",(async function(t,n){let{user:i,firstName:o,lastName:s,password:r}=t;return console.log("PPPPPPPPPPPPPPPPPPPPp"),new Promise((async function(t,c){console.log("step1...");let[l,p]=await a(e.sendSaveTeletry({type:"users",action:"create",user:i,firstName:o,lastName:s,password:r},n));if(l)return console.log("REJECTED========"),console.log(l),c(l);if(n){if(console.log("NEVER WAITING"),[l,p]=await a(e.checkSuccessfulCreateUser(i,r)),l)return c(l);t(p)}else{console.log("result from creating user");let n=JSON.parse(JSON.stringify(p));if(console.log(p),0===Object.keys(p).length){if([l,p]=await a(e.login({username:i,password:r})),l)return c("Registration failed. Please try submitting the form again");t({})}else t(n)}}))})),o()(this,"checkSuccessfulCreateUser",(async function(t,n){return new Promise((async function(i,o){let s=(new Date).getTime();console.log("starting for sure...");const r=async function(){console.log("here.....");let l=c({length:20,type:"url-safe"});return e.once(l,r),new Promise((async function(c,p){let[u,f]=await a(e.login({username:t,password:n}));if(u){console.log(u.data);let n=(new Date).getTime(),i=n-s;i<=1e4?e.emit(l):(e.removeListener(l,r),o(`Error creating account. Probably ${t} already exists`),p("Timed out"))}if(void 0!==f)return console.log(f),e.removeListener(l,r),c(f.data),i(f.data);{let t=(new Date).getTime(),n=t-s;n<=1e4?e.emit(l):(e.removeListener(l,r),o("Error creating account. Probably ${user} already exists"),p("Timed out"))}}))};await a(r())}))})),o()(this,"deleteUser",(async function(t){return new Promise((async function(n,i){console.log("STARGINT TO DELETE");let[o,s]=await a(e.sendSaveTeletry({type:"users",action:"delete",user:t}));if(o)return console.log("REJECTED========"),console.log(o),i(o);let r=JSON.parse(JSON.stringify(s));console.log(s),n(r)}))})),o()(this,"getActivationLink",(async function(t,n){return new Promise((async function(i,o){let r=`${e.settings.TBURL}/user/${t}/activationLink`,[c,l]=await a(s.get(`${e.settings.JSONPROXY}?path=${r}`,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+n}}));if(c)return o(c);i(l.data)}))})),o()(this,"createProject",(async function(t,n,i){return new Promise((async function(n,i){let[o,s]=await a(e.sendSaveTeletry({type:"projects",action:"create",project:t}));if(console.log("adhkjashdkhasdk"),o)return i(o);console.log("RETURNED..."),console.log(s),n(s)}))})),o()(this,"deleteRole",(async function(t){return new Promise((async function(n,i){let[o,s]=await a(e.sendSaveTeletry({type:"roles",action:"delete",role:t}));if(o)return i(o);n(s)}))})),o()(this,"deleteProject",(async function(t){return new Promise((async function(n,i){let[o,s]=await a(e.sendSaveTeletry({type:"projects",action:"delete",project:t}));if(o)return i(o);n(s)}))})),o()(this,"createApplication",(async function(t,n){let{application:i,description:o,icon:s,link:r}=t;return new Promise((async function(t,c){let[l,p]=await a(e.sendSaveTeletry({type:"applications",action:n,application:i,description:o,icon:s,link:r}));if(l)return c(l);t(p)}))})),o()(this,"fetchApplications",(async function(){return new Promise((async function(t,n){let[i,o]=await a(e.sendSaveTeletry({type:"applications",action:"get"}));if(i)return n(i);t(o)}))})),o()(this,"deleteApplication",(async function(t){return new Promise((async function(n,i){let[o,s]=await a(e.sendSaveTeletry({type:"applications",action:"delete",application:t}));if(o)return i(o);n(s)}))})),o()(this,"readUserData",(async function(){return new Promise((async function(t,n){let i=`${e.settings.TBURL}/auth/user`,[o,r]=await a(s.get(i,{headers:{"Content-Type":"application/json","X-Authorization":"Bearer "+e.jwt_token}}));return o?n(o):t(r.data)}))})),o()(this,"sendSaveTeletry",(async function(t,n=!1){return t.userId||(t.userId=e.userId),t.jwt_token||e.jwt_token&&(t.jwt_token=e.jwt_token),t.rqId||(t.rqId=c({length:20,type:"url-safe"})),console.log("step2"),console.log({data:t}),new Promise((async function(i,o){let r=e.settings.PUBLIC_DEVICE_ACCESS_TOKEN;console.log(e.settings);let l=e.settings.CORS_PROXY,p=`${e.settings.TBURL}/v1/${r}/telemetry`;console.log(t);let[u,f]=await a(s.post(`${l}/${p}`,t,{headers:{"Content-Type":"application/json"}}));if(console.log("ERRED......"),console.log(u),console.log(f),u)return o(u);if(n)return console.log("NO WAITING.."),i(!0);let d=t.rqId,m=(new Date).getTime();const g=async function(){return new Promise((async function(t,n){let[s,r]=await a(e.readUserData()),l=c({length:20,type:"url-safe"});if(e.once(l,g),s)console.log(s.status),console.log(s.response.data.status),console.log(s.data),console.log(s),e.removeListener(l,g),401===s.response.data.status?(console.log("---------160"),t({}),i({})):(console.log("---------1601"),t(!1),o(s));else if(void 0===r.additionalInfo)o("Unknown error occured"),t(!1);else{let n=r.additionalInfo.responses;if(n&&n[d]){console.log("---------167");let a=n[d];return console.log(a),a.msg.error?(e.removeListener(l,g),t(!1),o(a.msg.error)):(console.log("returned...."),console.log(a.msg),i(a.msg),t(!0),console.log("after resolve....."),e.removeListener(l,g),i(a.msg))}{let n=(new Date).getTime(),i=n-m;i<=12e4?(console.log(i,d),e.emit(l)):(e.removeListener(l,g),o("timed out"),t(!1))}}}))};await a(g())}))}))}openLink(e,t=!1){window.open(e,t)}}const u=new p;t["default"]=u},"5c23":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{attrs:{padding:""}},[n("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:e.createApplicationDialog,callback:function(t){e.createApplicationDialog=t},expression:"createApplicationDialog"}},[n("q-card",{staticClass:"bg-secondary text-white"},[n("q-card-section",{staticClass:"text-center text-h3"},[n("div",{staticClass:"text-subtitle2"},[e._v("Create New Application")])]),n("q-separator",{attrs:{dark:""}}),n("q-card-section",[n("q-form",{ref:"newApplicationForm",staticClass:"col q-gutter-md text-white",on:{submit:e.createApplication,reset:e.onReset}},[n("q-input",{attrs:{filled:"",disable:"edit"===e.dialogFor,type:"text",label:"Application Name",hint:"Application Name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter application name"}]},on:{input:e.repoNameFromApplication,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.application,callback:function(t){e.application=t},expression:"application"}}),n("q-input",{attrs:{disable:"",filled:"",autogrow:"",type:"text",label:"Description",hint:"Description","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter a description of the application"}]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.application,callback:function(t){e.application=t},expression:"application"}}),n("q-input",{attrs:{filled:"",type:"text",label:"Icon",hint:"Material Icon","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter application icon name"}]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:e.icon}})]},proxy:!0},{key:"after",fn:function(){return[n("q-btn",{attrs:{round:"",color:"primary"},on:{click:function(t){return e.openLink(e.settings.MATERIALICONS,"_blank")}}},[n("q-icon",{attrs:{name:"help"}}),n("q-tooltip",[e._v("\n        Get icon name from list of icons\n      ")])],1)]},proxy:!0}]),model:{value:e.icon,callback:function(t){e.icon=t},expression:"icon"}}),n("q-input",{attrs:{filled:"",type:"text",label:"Application Url",hint:"Application Url","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter application url"}]},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.link,callback:function(t){e.link=t},expression:"link"}}),n("div",{staticClass:"col"},[n("q-btn",{attrs:{label:"create"===e.dialogFor?"Create":"Edit",type:"submit",color:"primary"}}),n("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}})],1)],1)],1)],1)],1),n("q-table",{attrs:{grid:"","card-container-class":e.cardContainerClass,data:e.applications,columns:e.columns,title:"Applications","row-key":"name",filter:e.filter,"hide-bottom":"","rows-per-page-options":e.rowsPerPageOptions},scopedSlots:e._u([{key:"top-right",fn:function(){return[n("q-btn",{attrs:{flat:""}},[n("q-icon",{attrs:{color:"primary",name:"refresh",side:""},on:{click:function(t){return e.fetchApplications()}}})],1),n("q-btn",{attrs:{flat:""}},[n("q-icon",{attrs:{color:"primary",name:"add_circle",side:""},on:{click:function(t){e.createApplicationDialog=!0,e.dialogFor="create"}}})],1),n("q-space"),n("q-input",{attrs:{dense:"",debounce:"300",placeholder:"Search"},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[n("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1)]},proxy:!0},{key:"item",fn:function(t){return[n("div",{staticClass:"q-pa-xs col-xs-12 col-sm-6 col-md-4"},[n("q-card",{staticClass:"bg-white"},[n("q-card-section",{staticClass:"text-left text-h6"},[n("div",[n("span",[n("strong",[e._v(e._s(t.row.name))])]),n("span",{staticClass:"float-right"},[n("q-btn",{attrs:{disable:""},on:{click:function(n){e.createApplicationDialog=!0,e.dialogFor="edit",e.selectRow(t.row)}}},[n("q-icon",{attrs:{name:"edit",color:"green"}})],1),n("q-btn",{on:{click:function(n){return e.deleteApplication(t.row.name)}}},[n("q-icon",{attrs:{name:"delete",color:"red"}})],1)],1)])]),n("q-card-section",{staticClass:"flex flex-center"},[n("q-card",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"bg-primary cursor-pointer q-hoverable",staticStyle:{width:"80vw"},on:{click:function(n){return e.selectApplication(t.row.link)}}},[n("q-card-section",{staticClass:"text-center"},[n("q-icon",{staticStyle:{"font-size":"6em"},attrs:{name:t.row.icon,color:"white"}})],1),n("q-card-section",{staticClass:"flex flex-center text-white"},[n("div",[e._v(e._s(t.row.description))])])],1)],1)],1)],1)]}}])}),n("div",{staticClass:"row"})],1)},o=[],a=(n("e01a"),n("c975"),n("26e9"),n("e6cf"),n("5319"),n("ddb0"),n("cf57"));n("bc3a");const s=n("1712").to,r=n("ff00"),c=r,l=n("547a").default,{Octokit:p}=n("1af2"),u=n("e350").default,f=new u;var d={name:"Applications",components:{},async created(){f.on("error",this.loadList),f.emit("error"),l.setSettings({TBURL:r["TB_URL"]}),l.setSettings(r);let[e,t]=await s(l.isLoggedIn());e?window.location.assign("#/"):[e,t]=await s(this.fetchApplications())},beforeDestroy(){f.removeListener("error",this.loadList)},data(){return{settings:c,filter:"",application:"",description:"",link:"",icon:"apps",applications:[],columns:[{name:"name",label:"Name",field:"name"},{name:"description",label:"Description",field:"description"},{name:"icon",label:"Icon",field:"icon"}],createApplicationDialog:!1,dialogFor:"create",applications:[],allApplications:[],application:""}},methods:{selectRow(e){this.application=e.name,this.link=e.link,this.icon=e.icon,this.description=e.description},openLink(e,t){l.openLink(e,!1)},filterFn(e,t){t(""!==e?()=>{const t=e.toLowerCase();this.applications=this.allApplications.filter((e=>e.toLowerCase().indexOf(t)>-1))}:()=>{this.applications=this.allApplications})},onReset(){this.application="",this.description="",this.link="",this.icon="apps"},submit(){this.$refs.newApplicationForm.submit()},alert(e){alert(e)},async createApplication(){return new Promise((async(e,t)=>{if(""===this.application)return this.$q.notify({type:"negative",message:"Application cannot be blank"}),t("application cannot be blank");this.working=!0,this.showCustom("creating application");let n="create"===this.dialogFor?"create":"edit",[i,o]=await s(l.createApplication({application:this.application,description:this.application,icon:this.icon,link:this.link},n));if(this.working=!1,i)return this.$q.notify({type:"negative",message:i.msg||i}),e(!1);this.applications=o.applications,this.onReset(),this.createApplicationDialog=!1,this.$nextTick((()=>{this.createApplicationDialog=!0}))}))},async fetchApplications(){return new Promise((async(e,t)=>{this.working=!0,this.showCustom("fetching applications");let[n,i]=await s(l.fetchApplications());this.working=!1,n?(this.$q.notify({type:"negative",message:n}),e(!1)):(this.applications=i.applications,e(i.applications))}))},async deleteApplication(e){return new Promise((async(t,n)=>{let[i,o]=await s(this.confirm(`Are you sure you want to delete ${e}`,"Delete Application"));return i?t(!1):(this.working=!0,this.showCustom("deleting application"),[i,o]=await s(l.deleteApplication(e)),this.working=!1,i?(this.$q.notify({type:"negative",message:i.msg||i}),t(!1)):(this.applications=o.applications,void t(o.applications)))}))},async confirm(e,t="Confirm"){return new Promise(((n,i)=>{this.$q.dialog({title:t,message:e,cancel:!0,persistent:!0}).onOk((()=>n(!0))).onOk((()=>n(!0))).onCancel((()=>i(!0))).onDismiss((()=>i(!0)))}))},showCustom(e="",t="",n=0){const i=this.$q.dialog({title:e,message:t,progress:{spinner:a["a"],color:"primary"},persistent:!0,ok:!1});let o,s,r=n;i.update({message:`${r} secs`});const c=()=>{clearInterval(o),clearInterval(s),i.hide()};s=setInterval((()=>{n>0?(r--,0===r&&c()):r++,i.update({message:`${r} secs`})}),1e3),o=setInterval((()=>{!1===this.working&&c()}),500)},async loadList(){return new Promise((async(e,t)=>{this.working=!0,this.showCustom("Loading");c.CORS_PROXY,c.LISTURL;const n=new p({});let i=c.LISTURL.split("/").reverse(),o=i[0],a=i[2],r=i[3],[l,u]=await s(n.request(`GET /repos/${r}/${a}/contents/${o}`,{owner:r,repo:a,path:o}));this.working=!1,l?(this.working=!0,this.showCustom("Error. Going to refresh.","",5),setTimeout((()=>{this.working=!1,f.emit("error")}),5e3)):this.listLoaded(JSON.parse(atob(u.data.content)))}))},listLoaded(e){let t=[];for(let n in e){let i=e[n];t.push(i)}this.allApplications=[...t],this.applications=[...this.allApplications]},repoNameFromApplication(e){this.repoNameFromApplication(e)},repoNameFromApplication(e){this.repo=`${(this.application||"").toLowerCase().replace(".","-").replace(" ","-")}.${(this.application||"").toLowerCase().replace(".","-").replace(" ","-")}.gsp`},selectApplication(e){window.location.assign(e)}},computed:{cardContainerClass(){if(this.$q.screen.gt.xs)return"grid-masonry grid-masonry--"+(this.$q.screen.gt.sm?"3":"2")},rowsPerPageOptions(){return[0]}}},m=d,g=n("2877"),h=n("9989"),y=n("24e8"),w=n("f09f"),k=n("a370"),b=n("eb85"),v=n("0378"),T=n("27f9"),P=n("0016"),A=n("9c40"),C=n("05c0"),S=n("eaac"),q=n("2c91"),I=n("1c1c"),L=n("0170"),x=n("66e5"),R=n("4074"),_=n("714f"),E=n("eebe"),O=n.n(E),N=Object(g["a"])(m,i,o,!1,null,null,null);t["default"]=N.exports;O()(N,"components",{QPage:h["a"],QDialog:y["a"],QCard:w["a"],QCardSection:k["a"],QSeparator:b["a"],QForm:v["a"],QInput:T["a"],QIcon:P["a"],QBtn:A["a"],QTooltip:C["a"],QTable:S["a"],QSpace:q["a"],QList:I["a"],QItemLabel:L["a"],QItem:x["a"],QItemSection:R["a"]}),O()(N,"directives",{Ripple:_["a"]})},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){},e350:function(e,t,n){"use strict";n.r(t);n("c975"),n("a434");class i{constructor(){this.events={}}on(e,t){return"object"!==typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t),()=>this.removeListener(e,t)}removeListener(e,t){if("object"===typeof this.events[e]){const n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}emit(e,...t){"object"===typeof this.events[e]&&this.events[e].forEach((e=>e.apply(this,t)))}once(e,t){const n=this.on(e,((...e)=>{n(),t.apply(this,e)}))}}t["default"]=i},ff00:function(e){e.exports=JSON.parse('{"TB_URL":"https://demo.thingsboard.io/api","PUBLIC_DEVICE_ACCESS_TOKEN":"9sE9Z86OdYsynyCJKjnq","CORS_PROXY":"https://cors.cseco.co.ke","JSONPROXY":"https://jsonproxy.cseco.co.ke","LISTURL":"https://raw.githubusercontent.com/GospelSounders/applications-list/master/applications.json","MATERIALICONS":"https://material.io/resources/icons/"}')}}]);