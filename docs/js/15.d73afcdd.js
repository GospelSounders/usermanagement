(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{3120:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=this,s=t.$createElement,a=t._self._c||s;return a("q-page",{attrs:{padding:""}},[a("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:t.createUserDialog,callback:function(e){t.createUserDialog=e},expression:"createUserDialog"}},[a("q-card",{staticClass:"bg-secondary text-white"},[a("q-card-section",{staticClass:"text-center text-h3"},[a("div",{staticClass:"text-subtitle2"},[t._v("Create New User")])]),a("q-separator",{attrs:{dark:""}}),a("q-card-section",[a("q-form",{ref:"userRegistrationForm",staticClass:"col q-gutter-md text-white",on:{submit:t.createUser,reset:t.onReset}},[a("q-input",{attrs:{filled:"",type:"text",label:"first name",hint:"first name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your name"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.firstName,callback:function(e){t.firstName=e},expression:"firstName"}}),a("q-input",{attrs:{filled:"",type:"text",label:"last name",hint:"last name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your name"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.lastName,callback:function(e){t.lastName=e},expression:"lastName"}}),a("q-input",{attrs:{filled:"",type:"email",label:"email",hint:"email","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter your email address"},function(t){return e.isValidEmail()||"Invalid email address"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),a("q-input",{attrs:{filled:"",type:"password",label:"Password","lazy-rules":"",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":t.passwordErrorMessage},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),a("q-input",{attrs:{filled:"",type:"password",label:"Password","lazy-rules":"",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":t.passwordErrorMessage},model:{value:t.cpassword,callback:function(e){t.cpassword=e},expression:"cpassword"}}),a("div",{staticClass:"col"},[a("q-btn",{attrs:{label:"Create",type:"submit",color:"primary"}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}})],1)],1)],1)],1)],1),a("div",{staticClass:"row"},[a("q-table",{staticClass:"col",attrs:{title:"Users",dense:"",data:t.users,columns:t.columns,filter:t.filter,"row-key":"index"},on:{"row-click":t.selectUser},scopedSlots:t._u([{key:"top-right",fn:function(){return[a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[a("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1),a("q-btn",{attrs:{flat:""}},[a("q-icon",{attrs:{color:"primary",name:"refresh",side:""},on:{click:function(e){return t.fetchUsers()}}})],1),a("q-btn",{attrs:{flat:""}},[a("q-icon",{attrs:{color:"primary",name:"add_circle",side:""},on:{click:function(e){t.createUserDialog=!0}}})],1)]},proxy:!0}])})],1),a("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:t.selectedUser,callback:function(e){t.selectedUser=e},expression:"selectedUser"}},[a("q-card",[a("q-card-section",[a("div",{staticClass:"text-h6 text-center"},[t._v("\n          "+t._s(t.selectedFirstName)+" "+t._s(t.selectedLastName)+"\n        ")])]),a("q-card-section",{staticClass:"q-pt-none text-center"},[t._v("\n        "+t._s(t.selectedEmail)+"\n      ")]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-btn",{attrs:{label:"delete"},on:{click:t.deleteUser}},[a("q-icon",{attrs:{name:"delete",color:"red"}})],1),a("q-btn",{attrs:{label:"roles"},on:{click:t.fetchUserRoles}},[a("q-icon",{attrs:{name:"security",color:"primary"}})],1),a("q-btn",{attrs:{label:"projects"},on:{click:t.fetctUserProjects}},[a("q-icon",{attrs:{name:"group_work",color:"secondary"}})],1),a("q-btn",{attrs:{label:"Edit"},on:{click:t.showChangeUserNamesDialog}},[a("q-icon",{attrs:{name:"group_work",color:"secondary"}})],1)],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Ok",color:"primary"}})],1)],1)],1),a("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:t.userRolesDialog,callback:function(e){t.userRolesDialog=e},expression:"userRolesDialog"}},[a("q-card",{staticStyle:{width:"300px"}},[a("q-card-section",[a("q-table",{staticClass:"col",attrs:{title:"User Roles",dense:"",data:t.userRoles,columns:t.userRolesColumns,filter:t.userRolesFilter,"row-key":"index",flat:""},scopedSlots:t._u([{key:"top-right",fn:function(){return[a("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Search"},model:{value:t.userRolesFilter,callback:function(e){t.userRolesFilter=e},expression:"userRolesFilter"}},[a("q-icon",{attrs:{slot:"append",name:"search"},slot:"append"})],1),a("q-btn",{attrs:{flat:""}},[a("q-icon",{attrs:{color:"primary",name:"refresh",side:""},on:{click:function(e){return t.fetchUserRoles()}}})],1),a("q-btn",{attrs:{flat:""}},[a("q-icon",{attrs:{color:"primary",name:"add_circle",side:""},on:{click:t.addUserRole}})],1)]},proxy:!0},{key:"body-cell-actions",fn:function(e){return[a("q-td",{attrs:{props:e}},[a("q-btn",{attrs:{dense:"",round:"",flat:"",color:"red",icon:"delete"},on:{click:function(s){return t.deleteUserRole(e.row)}}})],1)]}}])})],1)],1)],1),a("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:t.addRoleDialog,callback:function(e){t.addRoleDialog=e},expression:"addRoleDialog"}},[a("q-card",{staticStyle:{width:"300px"}},[a("q-card-section",[a("q-form",{ref:"newProjectForm",staticClass:"col q-gutter-md text-white",on:{submit:t.submitAddUserRole,reset:t.onResetAddUserRole}},[a("q-select",{attrs:{clearable:"","use-input":"",filled:"",options:t.roles,label:"Role","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please select role"}]},on:{filter:t.filterFn},model:{value:t.role,callback:function(e){t.role=e},expression:"role"}}),a("div",{staticClass:"col"},[a("q-btn",{attrs:{label:"Create",type:"submit",color:"primary"}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}})],1)],1)],1)],1)],1),a("q-dialog",{attrs:{"transition-show":"rotate","transition-hide":"rotate"},model:{value:t.changeUserNamesDialog,callback:function(e){t.changeUserNamesDialog=e},expression:"changeUserNamesDialog"}},[a("q-card",{staticClass:"items-center text-center bg-white"},[a("q-card-section",[a("div",{staticClass:"row"},[a("div",{staticClass:"items-left text-left"},[a("div",{staticClass:"text-h4"},[t._v("Change Names")]),a("div",[t._v(t._s(t.email))])]),a("q-space")],1)]),a("q-card-section",[a("q-form",{ref:"changeUserNameForm",staticClass:"q-gutter-md text-white",on:{submit:t.changeuserNames,reset:t.onResetChangeUserNames}},[a("q-input",{attrs:{filled:"",type:"text",label:"First Name",hint:"First Name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter the first name"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitChangeUserName(e)}},model:{value:t.firstName,callback:function(e){t.firstName=e},expression:"firstName"}}),a("q-input",{attrs:{filled:"",type:"text",label:"Last Name",hint:"Last Name","lazy-rules":"",rules:[function(e){return e&&e.length>0||"Please enter the last name"}]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submitChangeUserName(e)}},model:{value:t.lastName,callback:function(e){t.lastName=e},expression:"lastName"}}),a("div",{staticClass:"row"},[a("q-space"),a("div",{staticClass:"items-left text-left"},[a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"primary",flat:""}}),a("q-btn",{attrs:{label:"Save",type:"submit",color:"green",disable:t.userEditted}})],1)],1)],1)],1)],1)],1)],1)},r=[],i=(s("c975"),s("e6cf"),s("ddb0"),s("cf57"));s("bc3a");const l=s("1712").to,o=s("ff00"),n=s("547a").default,c=s("6daa").default;var d={name:"Users",components:{},async created(){n.setSettings({TBURL:o["TB_URL"]}),n.setSettings(o);let[e,t]=await l(n.isLoggedIn());e?window.location.assign("#/"):[e,t]=await l(this.fetchUsers())},data(){return{changeUserNamesDialog:!1,email:"",firstName:"",lastName:"",firstNameOriginal:"",lastNameOriginal:"",password:"",cpassword:"",passwordErrorMessage:"",users:[],userRoles:[],roles:[],roles:[],rolesObj:{},allRoles:[],role:"",filter:"",userRolesFilter:"",selectedUser:!1,userRolesDialog:!1,createUserDialog:!1,addRoleDialog:!1,userRolesColumns:[{name:"name",required:!0,label:"Role",align:"left",field:e=>e.name,format:e=>`${e||""}`,sortable:!0},{name:"actions",label:"Actions",field:"",align:"center"}],columns:[{name:"firstName",required:!0,label:"First Name",align:"left",field:e=>e.firstName,format:e=>`${e||""}`,sortable:!0},{name:"lastName",required:!0,label:"Last Name",align:"left",field:e=>e.lastName,format:e=>`${e||""}`,sortable:!0},{name:"email",required:!0,label:"Email",align:"left",field:e=>e.email,format:e=>`${e||""}`,sortable:!0}],selectedEmail:"",selectedId:"",selectedFirstName:"",selectedLastName:""}},computed:{userEditted(){return this.firstName===this.firstNameOriginal&&this.lastName===this.lastNameOriginal}},methods:{onResetChangeUserNames(){this.firstName=this.firstNameOriginal,this.lastName=this.lastNameOriginal},async showChangeUserNamesDialog(){return new Promise((async(e,t)=>{let s=c.showDialog(this,"Loading User Data",""),[a,r]=await l(n.readSingleUserData(this.selectedId));if(c.emit(s),a)return this.$q.notify({type:"negative",message:a.msg||a}),e(!1);console.log(r),this.setUserData(r),this.changeUserNamesDialog=!0}))},setUserData(e){this.userData=e,this.email=e.email,this.firstName=e.firstName,this.lastName=e.lastName,this.firstNameOriginal=e.firstName,this.lastNameOriginal=e.lastName,this.loaded=!0,this.lastLogin=new Date(e.additionalInfo.lastLoginTs)},notUserEditted(){return this.firstName===this.firstNameOriginal&&this.lastName===this.lastNameOriginal},async changeuserNames(){return new Promise((async(e,t)=>{if(this.notUserEditted())return e(!1);let s=this.userData;s.firstName=this.firstName,s.lastName=this.lastName;let a=c.showDialog(this,"Changing User Name",""),[r,i]=await l(n.saveUserData(s));if(c.emit(a),r)return this.$q.notify({type:"negative",message:r.msg||r}),e(!1);this.setUserData(i),e(i),await l(this.fetchUsers()),this.changeUserNamesDialog=!1}))},submitChangeUserName(){this.$refs.changeUserNameForm.submit()},async deleteUserRole(e){let[t,s]=await l(this.confirm(`Are you sure you want to remove ${e.name} from ${this.selectedFirstName} ${this.selectedLastName}`,"Remove Role"));if(t)return resolve(!1);this.working=!0,this.showCustom(),[t,s]=await l(n.removeUserRole(this.selectedId,e.id)),this.working=!1,t?(this.$q.notify({type:"negative",message:t.msg||t}),resolve(!1)):(this.addRoleDialog=!1,this.role="",this.userRoles=s.roles)},filterFn(e,t){t(""!==e?()=>{const t=e.toLowerCase();this.roles=this.allRoles.filter((e=>e.toLowerCase().indexOf(t)>-1))}:()=>{let e=this.userRoles.map((e=>e.name));this.roles=this.allRoles.filter((t=>!e.includes(t)))})},submit(){this.$refs.userRegistrationForm.submit()},selectUser(e,t){this.selectedUser=!0,this.selectedEmail=t.email,this.selectedId="object"===typeof t.id?t.id.id:t.id,this.selectedFirstName=t.firstName,this.selectedLastName=t.lastName,console.log("clicked on",t)},isValidEmail(){const e=/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/;return e.test(this.email)||"Invalid email"},onReset(){this.email=null,this.firstName=null,this.lastName=null,this.password=null,this.cpassword=null},onResetAddUserRole(){this.role=""},async submitAddUserRole(){let e;for(let a in this.rolesObj)this.rolesObj[a].name===this.role&&(e=this.rolesObj[a].id);this.working=!0,this.showCustom();let[t,s]=await l(n.addUserRole(this.selectedId,e));if(this.working=!1,t)this.$q.notify({type:"negative",message:t.msg||t}),resolve(!1);else{if(this.showCustom(),[t,s]=await l(n.fetchUserRoles(this.selectedId)),this.working=!1,t)return console.log(t),this.$q.notify({type:"negative",message:t.msg||t}),resolve(!1);this.addRoleDialog=!1,this.role="",this.userRoles=s.roles}},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:i["a"],color:"primary"},persistent:!0,ok:!1}),s=setInterval((()=>{!1===this.working&&(clearInterval(s),t.hide())}),500)},alert(e){alert(e)},async createUser(){return new Promise((async(e,t)=>{if(this.password!==this.cpassword)return this.cpassword="",this.passwordErrorMessage="Passwords don't match",this.$q.notify({type:"negative",message:"Passwords don't match"}),e(!1);this.working=!0,this.showCustom();let[s,a]=await l(n.createUser({user:this.email,firstName:this.firstName,lastName:this.lastName,password:this.password}));this.working=!1,s?(this.$q.notify({type:"negative",message:s.msg||s}),e(!1)):(this.users.push(a),this.$q.notify({type:"positive",message:"User has been created"}),this.createUserDialog=!1,this.onReset(),this.$nextTick((()=>{this.createUserDialog=!0})))}))},async fetchUsers(){return new Promise((async(e,t)=>{let s=c.showDialog(this,"Fetching Users",""),[a,r]=await l(n.fetchUsers());c.emit(s),a?(this.$q.notify({type:"negative",message:a}),e(!1)):(this.users=r.users,e(r.users))}))},async deleteUser(e){return new Promise((async(e,t)=>{let[s,a]=await l(this.confirm(`Are you sure you want to delete ${this.selectedEmail}`,"Delete User"));return s?e(!1):(this.working=!0,this.showCustom(),[s,a]=await l(n.deleteUser(this.selectedId)),this.working=!1,s?(console.log(s),this.$q.notify({type:"negative",message:s.msg||s}),e(!1)):(this.users=a.users,this.selectedUser=!1,this.$q.notify({type:"positive",message:`${this.selectedEmail} deleted.`}),void e(a.users)))}))},async addUserRole(){if(0===this.allRoles.length){this.working=!0,this.showCustom();let[e,t]=await l(n.fetchRoles());if(this.working=!1,e)return console.log(e),this.$q.notify({type:"negative",message:e.msg||e}),resolve(!1);{this.rolesObj=t.roles;let e=[];for(let t in this.rolesObj)e.push(this.rolesObj[t].name);this.allRoles=e;let s=this.userRoles.map((e=>e.name));this.roles=this.allRoles.filter((e=>!s.includes(e))),console.log("required filter..."),console.log(this.userRoles),console.log(s)}this.addRoleDialog=!0}else{this.addRoleDialog=!0;let[e,t]=await l(n.fetchRoles());if(this.working=!1,e)return resolve(!1);{this.rolesObj=t.roles;let e=[];for(let t in this.rolesObj)e.push(this.rolesObj[t].name);this.allRoles=e;let s=this.userRoles.map((e=>e.name));this.roles=this.allRoles.filter((e=>!s.includes(e))),console.log(this.allRoles),console.log(s),console.log(this.roles)}}},async fetchUserRoles(){this.working=!0,this.showCustom();let[e,t]=await l(n.fetchUserRoles(this.selectedId));if(this.working=!1,e)return console.log(e),this.$q.notify({type:"negative",message:e.msg||e}),resolve(!1);this.userRoles=t.roles,this.userRolesDialog=!0},async fetctUserProjects(){this.working=!0,this.showCustom();let[e,t]=await l(n.fetctUserProjects(this.selectedId));if(this.working=!1,e)return console.log(e),this.$q.notify({type:"negative",message:e.msg||e}),resolve(!1);console.log(t),this.userProjects=t.projects,this.userProjectsDialog=!0},async confirm(e,t="Confirm"){return new Promise(((s,a)=>{this.$q.dialog({title:t,message:e,cancel:!0,persistent:!0}).onOk((()=>s(!0))).onOk((()=>s(!0))).onCancel((()=>a(!0))).onDismiss((()=>a(!0)))}))},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:i["a"],color:"primary"},persistent:!0,ok:!1}),s=setInterval((()=>{!1===this.working&&(clearInterval(s),t.hide())}),500)}}},m=d,u=s("2877"),h=s("9989"),f=s("24e8"),g=s("f09f"),p=s("a370"),y=s("eb85"),w=s("0378"),b=s("27f9"),q=s("9c40"),N=s("eaac"),k=s("0016"),U=s("bd08"),R=s("db86"),v=s("42a1"),C=s("1c1c"),x=s("0170"),D=s("2c91"),$=s("66e5"),O=s("4074"),P=s("4b7e"),_=s("ddd8"),E=s("7f67"),I=s("eebe"),F=s.n(I),j=Object(u["a"])(m,a,r,!1,null,null,null);t["default"]=j.exports;F()(j,"components",{QPage:h["a"],QDialog:f["a"],QCard:g["a"],QCardSection:p["a"],QSeparator:y["a"],QForm:w["a"],QInput:b["a"],QBtn:q["a"],QTable:N["a"],QIcon:k["a"],QTr:U["a"],QTd:R["a"],QPopupEdit:v["a"],QList:C["a"],QItemLabel:x["a"],QSpace:D["a"],QItem:$["a"],QItemSection:O["a"],QCardActions:P["a"],QSelect:_["a"]}),F()(j,"directives",{ClosePopup:E["a"]})}}]);